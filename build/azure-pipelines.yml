trigger:
  branches:
    include:
      - main
pr:
  branches:
    include:
      - main
      - release/*

variables:
- name: IsReleaseBranch # Should this branch name use the release stage
  value: $[eq(variables['Build.SourceBranch'], 'refs/heads/main')]
  
pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Build
  jobs:
  - job: Build
    displayName: 'Build'
    steps:
      - template: stage-build.yml

- stage: Release
  jobs:
  - job: Release
    displayName: 'Release'
    dependsOn: Build
    condition: and(succeeded(), eq(variables['IsReleaseBranch'], 'true'), ne(variables['Build.Reason'], 'PullRequest'))
    steps:
    - template: stage-release.yml
